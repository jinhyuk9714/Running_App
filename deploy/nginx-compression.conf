# =============================================================================
# Nginx Gzip 압축 설정
# =============================================================================
# 위치: /etc/nginx/conf.d/gzip.conf 또는 nginx.conf http 블록에 포함
#
# 효과:
# - API 응답 크기 60-80% 감소
# - 모바일/저속 네트워크 환경 성능 향상
# - CPU 약간 증가 vs 네트워크 대역폭 대폭 감소 (트레이드오프)
# =============================================================================

# Gzip 활성화
gzip on;

# 프록시된 요청도 압축 (Spring Boot 백엔드)
gzip_proxied any;

# 압축 레벨 (1-9, 높을수록 압축률↑ CPU↑)
# 6이 압축률/CPU 밸런스 최적
gzip_comp_level 6;

# 최소 압축 크기 (작은 응답은 압축 오버헤드가 더 큼)
gzip_min_length 256;

# 압축할 MIME 타입
gzip_types
    application/json
    application/javascript
    application/xml
    application/xml+rss
    text/css
    text/javascript
    text/plain
    text/xml
    image/svg+xml;

# Vary 헤더 추가 (프록시 캐시 호환성)
gzip_vary on;

# IE6 이하 비활성화 (오래된 브라우저 호환성)
gzip_disable "MSIE [1-6]\.";

# =============================================================================
# 적용 예시 (server 블록에서 include)
# =============================================================================
#
# server {
#     listen 443 ssl;
#     server_name example.com;
#
#     include /etc/nginx/conf.d/gzip.conf;
#
#     location /api/ {
#         proxy_pass http://localhost:8080;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
# }
#
# =============================================================================
# 검증 명령어
# =============================================================================
#
# # 압축 응답 확인
# curl -s -D - -o /dev/null -H "Accept-Encoding: gzip" https://example.com/api/challenges | grep -i encoding
# # 예상 출력: Content-Encoding: gzip
#
# # 압축률 측정
# COMPRESSED=$(curl -s -o /dev/null -w "%{size_download}" -H "Accept-Encoding: gzip" https://example.com/api/challenges)
# UNCOMPRESSED=$(curl -s -o /dev/null -w "%{size_download}" -H "Accept-Encoding: identity" https://example.com/api/challenges)
# echo "압축률: $(echo "scale=1; (1-$COMPRESSED/$UNCOMPRESSED)*100" | bc)%"
#
